# Phase 0.0.4 PRD — Wallet 관리 UI + 상태 흐름

## 목표
- 인증/바인딩 완료 후 사용자가 자신의 지갑 상태를 확인할 수 있게 한다.
- 전체 사용자 여정(인증 → 바인딩 → 확인)을 화면 흐름으로 완성한다.

## 범위
- FE: 지갑 목록 화면, 상태 배지, 복사/검증 완료 표시
- FE: 세션 없음은 SessionGuard가 /home으로 리다이렉트
- FE: “내 세금 리포트 보기”는 비범위 또는 차기 Phase로 이관
- BE: 지갑 목록 조회 API

## 비범위
- 지갑 삭제/해제
- 세금 리포트 생성

## 사용자 플로우
1. 인증 완료 사용자는 지갑 목록 화면 진입
2. 바인딩된 지갑 리스트 확인
3. 필요 시 새 지갑 바인딩 진입(Phase 0.0.3 연동)

## 기능 요구사항
### FE
- 지갑 목록 카드/리스트 UI
- 주소 축약 표시 및 전체 복사 기능
- 상태(verified) 표시
- 세션 없음은 SessionGuard가 /home으로 리다이렉트
- 실패/빈 상태 UI
- MiniKit 지갑 주소가 없는 경우에도 Wallet Auth 팝업을 띄울 수 있어야 함
  - challenge 요청 시 임시 주소 사용
  - 서명 메시지에서 실제 주소를 파싱해 사용

### BE
- GET /api/wallet/bindings
  - 세션 기반 human_id 필수
  - 응답: [{ address, chain, verified_at, verification_method }]

## FE/BE 경계 (필수)
- FE: 지갑 목록 조회 호출 + 표시 UI만 담당
- BE: 세션 검증 + 지갑 조회 + 응답 스키마 보장 전담
- `app/api/wallet/bindings`는 컨트롤러 역할만 수행 (도메인 호출)

#### 응답 스키마 (P1)
**200 OK**
```json
{
  "wallets": [
    {
      "address": "0xabc...123",
      "chain": "evm",
      "verified_at": "2026-02-05T12:34:56Z",
      "verification_method": "SIWE"
    }
  ]
}
```

**401 Unauthorized**
```json
{
  "error": { "code": "UNAUTHORIZED", "message": "Session required" },
  "timestamp": "2026-02-06T12:34:56Z",
  "requestId": "uuid"
}
```

## 비기능/UX
- 탭 내비게이션 유지
- 좌우 패딩 24px, 섹션 간격 32px
- 초기 로딩 2–3초 내, 후속 액션 < 1초
- 저연결 상태/타임아웃 안내

## 분석 이벤트
- wallet_list_view
- wallet_copy

## 테스트
- BE: 세션 없는 요청 → 401
- BE: 정상 세션 → 지갑 목록 반환
- FE: 빈 상태/에러 상태 표시

## 완료 기준
- 지갑 목록 화면에서 바인딩 결과 확인 가능
- 세션 없을 때 /home으로 리다이렉트
- "내 세금 리포트 보기"는 비범위로 처리하거나 별도 Phase로 이관

---

## MiniApp UI 컴포넌트 규칙

### UI Kit 활용

`@worldcoin/mini-apps-ui-kit-react` 사용 권장:

```tsx
import { Button, Card, TabBar } from '@worldcoin/mini-apps-ui-kit-react'
```

### 레이아웃 규칙

| 항목 | 규칙 |
|------|------|
| 네비게이션 | Tab 내비게이션 유지 |
| 금지 요소 | 햄버거 메뉴, 사이드바, 푸터 |
| 좌우 패딩 | 24px |
| 섹션 간격 | 32px |

### 앱 자산 규격

| 자산 | 규격 | 비고 |
|------|------|------|
| App Icon | 정사각형 | 흰색 배경 제외 |
| Content Card | 345×240px | 하단 94px 여유 |

### 상태 관리 흐름

사용자 인증 → 지갑 바인딩 → 상태 확인의 순차 흐름을 유지:

```
┌─────────────────────────────────────────────────────────────┐
│                     사용자 여정 흐름                          │
├─────────────────────────────────────────────────────────────┤
│                                                              │
│   1. 인증 단계                                               │
│   ┌─────────────┐                                           │
│   │ World ID    │ ──▶ human_id 발급                         │
│   │ Verify      │     세션 생성                              │
│   └─────────────┘                                           │
│          │                                                   │
│          ▼                                                   │
│   2. 바인딩 단계                                             │
│   ┌─────────────┐                                           │
│   │ SIWE        │ ──▶ WalletBinding 생성                    │
│   │ Wallet Auth │     human ↔ address 매핑                  │
│   └─────────────┘                                           │
│          │                                                   │
│          ▼                                                   │
│   3. 확인 단계                                               │
│   ┌─────────────┐                                           │
│   │ 지갑 목록   │ ──▶ 바인딩 상태 표시                       │
│   │ 화면        │     추가 바인딩 가능                       │
│   └─────────────┘                                           │
│                                                              │
└─────────────────────────────────────────────────────────────┘
```

### 상태별 UI 처리

| 상태 | UI 처리 |
|------|---------|
| 세션 없음 | SessionGuard가 /home으로 리다이렉트 |
| 인증 완료 + 지갑 없음 | 지갑 바인딩 유도 |
| 인증 완료 + 지갑 있음 | 지갑 목록 표시 |
| 로딩 중 | 스켈레톤 UI (타임아웃 처리) |
| 에러 | 재시도 버튼 + 에러 메시지 |
| 오프라인 | 연결 상태 안내 |

### 성능 기준

| 메트릭 | 목표 |
|--------|------|
| 초기 로딩 | 2-3초 이내 |
| 후속 액션 | < 1초 |
| 화면 전환 | 부드러운 전환 (스켈레톤 활용) |

### 참조 문서
- `/docs/World-Chain-Guide.md` - UI/UX 가이드라인
- `/docs/phases/ENV.md` - 환경변수 통합 문서
- `/docs/phases/ARCHITECTURE.md` - FE/BE 경계 및 구조
- `@worldcoin/mini-apps-ui-kit-react` - 공식 UI Kit
